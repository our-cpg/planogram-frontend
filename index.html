<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Store Planner Pro - Ultimate Edition</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    // Enhanced Fixture Icons Library
    const FixtureIcons = {
      GridWall: () => (
        <svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
          <rect x="6" y="6" width="36" height="36" stroke="currentColor" strokeWidth="2" fill="none"/>
          <line x1="6" y1="18" x2="42" y2="18" stroke="currentColor" strokeWidth="2"/>
          <line x1="6" y1="30" x2="42" y2="30" stroke="currentColor" strokeWidth="2"/>
          <line x1="18" y1="6" x2="18" y2="42" stroke="currentColor" strokeWidth="2"/>
          <line x1="30" y1="6" x2="30" y2="42" stroke="currentColor" strokeWidth="2"/>
        </svg>
      ),
      JewelryCase: () => (
        <svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M8 14h32v20H8z" stroke="currentColor" strokeWidth="2" fill="none"/>
          <path d="M8 14l8-6h16l8 6" stroke="currentColor" strokeWidth="2" fill="none"/>
          <circle cx="24" cy="24" r="6" stroke="currentColor" strokeWidth="2" fill="none"/>
          <line x1="8" y1="34" x2="40" y2="34" stroke="currentColor" strokeWidth="3"/>
        </svg>
      ),
      Gondola: () => (
        <svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
          <rect x="10" y="8" width="28" height="32" stroke="currentColor" strokeWidth="2" fill="none"/>
          <line x1="10" y1="16" x2="38" y2="16" stroke="currentColor" strokeWidth="2"/>
          <line x1="10" y1="24" x2="38" y2="24" stroke="currentColor" strokeWidth="2"/>
          <line x1="10" y1="32" x2="38" y2="32" stroke="currentColor" strokeWidth="2"/>
          <rect x="8" y="38" width="32" height="4" fill="currentColor"/>
        </svg>
      ),
      SlatWall: () => (
        <svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
          <rect x="8" y="6" width="32" height="36" stroke="currentColor" strokeWidth="2" fill="none"/>
          <line x1="8" y1="14" x2="40" y2="14" stroke="currentColor" strokeWidth="1.5"/>
          <line x1="8" y1="20" x2="40" y2="20" stroke="currentColor" strokeWidth="1.5"/>
          <line x1="8" y1="26" x2="40" y2="26" stroke="currentColor" strokeWidth="1.5"/>
          <line x1="8" y1="32" x2="40" y2="32" stroke="currentColor" strokeWidth="1.5"/>
          <line x1="8" y1="38" x2="40" y2="38" stroke="currentColor" strokeWidth="1.5"/>
        </svg>
      ),
      EndCap: () => (
        <svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 8h24v32H12z" stroke="currentColor" strokeWidth="2" fill="none"/>
          <line x1="12" y1="18" x2="36" y2="18" stroke="currentColor" strokeWidth="2"/>
          <line x1="12" y1="28" x2="36" y2="28" stroke="currentColor" strokeWidth="2"/>
          <path d="M6 8h6v32H6z" fill="currentColor" opacity="0.3"/>
          <path d="M36 8h6v32h-6z" fill="currentColor" opacity="0.3"/>
        </svg>
      )
    };

    // UI Icons
    const Icons = {
      Plus: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>,
      Trash: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>,
      Edit: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>,
      Search: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.35-4.35"></path></svg>,
      Package: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path></svg>,
      DollarSign: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="1" x2="12" y2="23"></line><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></svg>,
      Save: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path><polyline points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline></svg>,
      Download: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>,
      Upload: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></svg>,
      Image: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg>,
      Flame: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"></path></svg>,
      ZoomIn: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line><line x1="11" y1="8" x2="11" y2="14"></line><line x1="8" y1="11" x2="14" y2="11"></line></svg>,
      ZoomOut: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line><line x1="8" y1="11" x2="14" y2="11"></line></svg>,
      Move: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="5 9 2 12 5 15"></polyline><polyline points="9 5 12 2 15 5"></polyline><polyline points="15 19 12 22 9 19"></polyline><polyline points="19 9 22 12 19 15"></polyline><line x1="2" y1="12" x2="22" y2="12"></line><line x1="12" y1="2" x2="12" y2="22"></line></svg>
    };

    const StorePlannerPro = () => {
      // State Management
      const [fixtures, setFixtures] = useState([]);
      const [sections, setSections] = useState({});
      const [selectedFixture, setSelectedFixture] = useState(null);
      const [selectedSection, setSelectedSection] = useState(null);
      const [upcInput, setUpcInput] = useState('');
      const [productSearchResults, setProductSearchResults] = useState([]);
      const [viewMode, setViewMode] = useState('normal');
      const [backgroundImage, setBackgroundImage] = useState(null);
      const [zoom, setZoom] = useState(1);
      const [pan, setPan] = useState({ x: 0, y: 0 });
      const [isDragging, setIsDragging] = useState(false);
      const [dragStart, setDragStart] = useState({ x: 0, y: 0 });
      const [showSettings, setShowSettings] = useState(false);
      const [timePeriod, setTimePeriod] = useState('month');
      const [customDateRange, setCustomDateRange] = useState({ start: '', end: '' });
      const [editingSection, setEditingSection] = useState(null);
      
      const [shopifyConfig, setShopifyConfig] = useState({
        storeName: 'a1beautysupply',
        accessToken: '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',
        connected: true
      });

      const canvasRef = useRef(null);
      const fileInputRef = useRef(null);
      const importInputRef = useRef(null);

      // Fixture Types with Enhanced Icons
      const fixtureTypes = [
        { 
          id: 'gridwall', 
          name: 'Grid Wall', 
          icon: FixtureIcons.GridWall,
          width: 180, 
          height: 100, 
          sectionType: 'zones',
          defaultSections: 12,
          color: '#3B82F6'
        },
        { 
          id: 'jewelry', 
          name: 'Jewelry Case', 
          icon: FixtureIcons.JewelryCase,
          width: 160, 
          height: 80, 
          sectionType: 'compartments',
          defaultSections: 20,
          color: '#8B5CF6'
        },
        { 
          id: 'gondola', 
          name: 'Gondola', 
          icon: FixtureIcons.Gondola,
          width: 200, 
          height: 120, 
          sectionType: 'shelves',
          defaultSections: 16,
          color: '#10B981'
        },
        { 
          id: 'slatwall', 
          name: 'Slat Wall', 
          icon: FixtureIcons.SlatWall,
          width: 180, 
          height: 100, 
          sectionType: 'zones',
          defaultSections: 15,
          color: '#F59E0B'
        },
        { 
          id: 'endcap', 
          name: 'End Cap', 
          icon: FixtureIcons.EndCap,
          width: 140, 
          height: 90, 
          sectionType: 'shelves',
          defaultSections: 9,
          color: '#EF4444'
        }
      ];

      // Add Fixture
      const addFixture = (type) => {
        const fixtureType = fixtureTypes.find(f => f.id === type);
        const newFixture = {
          id: Date.now(),
          type,
          name: fixtureType.name,
          x: 100,
          y: 100,
          width: fixtureType.width,
          height: fixtureType.height,
          sectionType: fixtureType.sectionType,
          color: fixtureType.color
        };
        
        setFixtures([...fixtures, newFixture]);
        
        // Create default sections
        const newSections = {};
        for (let i = 1; i <= fixtureType.defaultSections; i++) {
          newSections[`${newFixture.id}-${i}`] = {
            id: `${newFixture.id}-${i}`,
            name: `${fixtureType.sectionType.slice(0, -1)} ${i}`,
            fixtureId: newFixture.id,
            products: [],
            squareFeet: 2
          };
        }
        setSections({...sections, ...newSections});
      };

      // Add Rows to Section
      const addRowsToFixture = (fixtureId, numberOfRows) => {
        const fixture = fixtures.find(f => f.id === fixtureId);
        if (!fixture) return;

        const fixtureSections = Object.values(sections).filter(s => s.fixtureId === fixtureId);
        const currentMaxNumber = Math.max(...fixtureSections.map(s => {
          const match = s.name.match(/\d+$/);
          return match ? parseInt(match[0]) : 0;
        }));

        const newSections = {};
        for (let i = 1; i <= numberOfRows; i++) {
          const newNumber = currentMaxNumber + i;
          const sectionId = `${fixtureId}-${Date.now()}-${i}`;
          newSections[sectionId] = {
            id: sectionId,
            name: `${fixture.sectionType.slice(0, -1)} ${newNumber}`,
            fixtureId: fixtureId,
            products: [],
            squareFeet: 2
          };
        }
        
        setSections({...sections, ...newSections});
      };

      // Delete Fixture
      const deleteFixture = (id) => {
        setFixtures(fixtures.filter(f => f.id !== id));
        const newSections = {...sections};
        Object.keys(newSections).forEach(key => {
          if (newSections[key].fixtureId === id) {
            delete newSections[key];
          }
        });
        setSections(newSections);
        if (selectedFixture === id) setSelectedFixture(null);
      };

      // Rename Section
      const renameSection = (sectionId, newName) => {
        setSections({
          ...sections,
          [sectionId]: {
            ...sections[sectionId],
            name: newName
          }
        });
      };

      // Fetch Product from Shopify
      const searchShopifyProducts = async (query) => {
        if (!shopifyConfig.connected || !query) return;

        try {
          const response = await fetch(`https://planogram-backend-v83z.onrender.com/api/products/search?query=${encodeURIComponent(query)}`, {
            headers: {
              'x-shopify-store': shopifyConfig.storeName,
              'x-shopify-token': shopifyConfig.accessToken
            }
          });

          if (response.ok) {
            const data = await response.json();
            setProductSearchResults(data.products ? data.products : []);
          }
        } catch (error) {
          console.error('Error searching products:', error);
        }
      };

      // Add Product to Section
      const addProductToSection = (product) => {
        if (!selectedSection) return;

        const newProduct = {
          id: Date.now(),
          sku: product.sku || product.variants?.[0]?.sku,
          title: product.title,
          price: parseFloat(product.variants?.[0]?.price || 0),
          cost: parseFloat(product.variants?.[0]?.cost || 0),
          quantity: 1
        };

        setSections({
          ...sections,
          [selectedSection]: {
            ...sections[selectedSection],
            products: [...sections[selectedSection].products, newProduct]
          }
        });

        setUpcInput('');
        setProductSearchResults([]);
      };

      // Calculate Profits
      const calculateSectionProfit = (section) => {
        return section.products.reduce((total, product) => {
          const profit = (product.price - product.cost) * product.quantity;
          return total + profit;
        }, 0);
      };

      const calculateProfitPerSqFt = (section) => {
        const profit = calculateSectionProfit(section);
        return section.squareFeet > 0 ? profit / section.squareFeet : 0;
      };

      // Heat Map Color
      const getHeatMapColor = (profitPerSqFt) => {
        if (profitPerSqFt >= 100) return 'rgba(34, 197, 94, 0.7)';
        if (profitPerSqFt >= 50) return 'rgba(234, 179, 8, 0.7)';
        if (profitPerSqFt >= 25) return 'rgba(249, 115, 22, 0.7)';
        return 'rgba(239, 68, 68, 0.7)';
      };

      // Canvas Drawing
      useEffect(() => {
        const canvas = canvasRef.current;
        if (!canvas) return;

        const ctx = canvas.getContext('2d');
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // Apply transformations
        ctx.save();
        ctx.translate(pan.x, pan.y);
        ctx.scale(zoom, zoom);

        // Draw background image
        if (backgroundImage) {
          const img = new Image();
          img.src = backgroundImage;
          ctx.globalAlpha = 0.3;
          ctx.drawImage(img, 0, 0, canvas.width / zoom, canvas.height / zoom);
          ctx.globalAlpha = 1;
        }

        // Draw fixtures
        fixtures.forEach(fixture => {
          const fixtureType = fixtureTypes.find(f => f.id === fixture.type);
          const isSelected = selectedFixture === fixture.id;

          ctx.strokeStyle = isSelected ? '#2563EB' : fixture.color;
          ctx.lineWidth = isSelected ? 3 : 2;
          ctx.fillStyle = viewMode === 'heatmap' ? 'transparent' : `${fixture.color}15`;

          ctx.fillRect(fixture.x, fixture.y, fixture.width, fixture.height);
          ctx.strokeRect(fixture.x, fixture.y, fixture.width, fixture.height);

          // Draw fixture label
          ctx.fillStyle = '#000';
          ctx.font = 'bold 14px sans-serif';
          ctx.fillText(fixture.name, fixture.x + 10, fixture.y + 25);

          // Draw sections
          const fixtureSections = Object.values(sections).filter(s => s.fixtureId === fixture.id);
          const rows = Math.ceil(Math.sqrt(fixtureSections.length));
          const cols = Math.ceil(fixtureSections.length / rows);
          const sectionWidth = fixture.width / cols;
          const sectionHeight = fixture.height / rows;

          fixtureSections.forEach((section, idx) => {
            const row = Math.floor(idx / cols);
            const col = idx % cols;
            const sx = fixture.x + col * sectionWidth;
            const sy = fixture.y + row * sectionHeight;

            if (viewMode === 'heatmap') {
              const profitPerSqFt = calculateProfitPerSqFt(section);
              ctx.fillStyle = getHeatMapColor(profitPerSqFt);
              ctx.fillRect(sx, sy, sectionWidth, sectionHeight);
            }

            ctx.strokeStyle = selectedSection === section.id ? '#10B981' : '#94A3B8';
            ctx.lineWidth = selectedSection === section.id ? 2 : 1;
            ctx.strokeRect(sx, sy, sectionWidth, sectionHeight);

            // Draw section label
            ctx.fillStyle = '#000';
            ctx.font = '10px sans-serif';
            ctx.fillText(section.name, sx + 5, sy + 15);
          });
        });

        ctx.restore();
      }, [fixtures, sections, selectedFixture, selectedSection, backgroundImage, zoom, pan, viewMode]);

      // Mouse Events for Dragging
      const handleMouseDown = (e) => {
        if (e.button === 2 || e.ctrlKey) {
          setIsDragging(true);
          setDragStart({ x: e.clientX - pan.x, y: e.clientY - pan.y });
        } else {
          const rect = canvasRef.current.getBoundingClientRect();
          const x = (e.clientX - rect.left - pan.x) / zoom;
          const y = (e.clientY - rect.top - pan.y) / zoom;

          const clickedFixture = fixtures.find(f => 
            x >= f.x && x <= f.x + f.width && y >= f.y && y <= f.y + f.height
          );

          if (clickedFixture) {
            setSelectedFixture(clickedFixture.id);
            
            const fixtureSections = Object.values(sections).filter(s => s.fixtureId === clickedFixture.id);
            const rows = Math.ceil(Math.sqrt(fixtureSections.length));
            const cols = Math.ceil(fixtureSections.length / rows);
            const sectionWidth = clickedFixture.width / cols;
            const sectionHeight = clickedFixture.height / rows;

            fixtureSections.forEach((section, idx) => {
              const row = Math.floor(idx / cols);
              const col = idx % cols;
              const sx = clickedFixture.x + col * sectionWidth;
              const sy = clickedFixture.y + row * sectionHeight;

              if (x >= sx && x <= sx + sectionWidth && y >= sy && y <= sy + sectionHeight) {
                setSelectedSection(section.id);
              }
            });
          }
        }
      };

      const handleMouseMove = (e) => {
        if (isDragging) {
          setPan({
            x: e.clientX - dragStart.x,
            y: e.clientY - dragStart.y
          });
        }
      };

      const handleMouseUp = () => {
        setIsDragging(false);
      };

      // Zoom Controls
      const handleZoomIn = () => setZoom(Math.min(zoom + 0.1, 3));
      const handleZoomOut = () => setZoom(Math.max(zoom - 0.1, 0.5));

      // File Upload
      const handleImageUpload = (e) => {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = (e) => setBackgroundImage(e.target.result);
          reader.readAsDataURL(file);
        }
      };

      // Export/Import
      const exportLayout = () => {
        const data = {
          fixtures,
          sections,
          backgroundImage,
          shopifyConfig,
          exportDate: new Date().toISOString()
        };
        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `store-layout-${Date.now()}.json`;
        a.click();
      };

      const importLayout = (e) => {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = (e) => {
            try {
              const data = JSON.parse(e.target.result);
              setFixtures(data.fixtures ? data.fixtures : []);
              setSections(data.sections ? data.sections : {});
              setBackgroundImage(data.backgroundImage ? data.backgroundImage : null);
              alert('Layout imported successfully!');
            } catch (error) {
              alert('Error importing layout');
            }
          };
          reader.readAsText(file);
        }
      };

      // Save to localStorage
      const saveLayout = () => {
        localStorage.setItem('storePlannerLayout', JSON.stringify({
          fixtures,
          sections,
          backgroundImage
        }));
        alert('Layout saved!');
      };

      // Load from localStorage
      useEffect(() => {
        const saved = localStorage.getItem('storePlannerLayout');
        if (saved) {
          const data = JSON.parse(saved);
          setFixtures(data.fixtures ? data.fixtures : []);
          setSections(data.sections || {]);
          setBackgroundImage(data.backgroundImage ? data.backgroundImage : null);
        }

        // Load Shopify config from localStorage
        const savedShopify = localStorage.getItem('shopifyConfig');
        if (savedShopify) {
          setShopifyConfig(JSON.parse(savedShopify));
        }
      }, []);

      return (
        <div className="h-screen flex flex-col bg-gray-50">
          {/* Top Bar */}
          <div className="bg-white border-b border-gray-200 p-4 flex items-center justify-between flex-wrap gap-2">
            <h1 className="text-2xl font-bold text-gray-800">Store Planner Pro</h1>
            
            <div className="flex items-center gap-2 flex-wrap">
              {/* Time Period Filter */}
              <div className="flex items-center gap-2 bg-gray-100 px-3 py-2 rounded-lg">
                <Icons.Package />
                <span className="text-sm font-medium text-gray-700">Period:</span>
                <select
                  value={timePeriod}
                  onChange={(e) => setTimePeriod(e.target.value)}
                  className="px-2 py-1 bg-white border border-gray-300 rounded text-sm focus:outline-none focus:border-blue-500"
                >
                  <option value="day">Today</option>
                  <option value="week">This Week</option>
                  <option value="month">This Month</option>
                  <option value="quarter">This Quarter</option>
                  <option value="year">This Year</option>
                  <option value="all">All Time</option>
                </select>
              </div>

              <button
                onClick={() => setViewMode(viewMode === 'normal' ? 'heatmap' : 'normal')}
                className={`px-4 py-2 rounded-lg font-medium flex items-center gap-2 ${
                  viewMode === 'heatmap' 
                    ? 'bg-orange-500 text-white' 
                    : 'bg-gray-200 text-gray-700'
                }`}
              >
                <Icons.Flame />
                {viewMode === 'heatmap' ? 'Heat Map ON' : 'Heat Map'}
              </button>

              <input
                ref={fileInputRef}
                type="file"
                accept="image/*"
                onChange={handleImageUpload}
                className="hidden"
              />
              <button
                onClick={() => fileInputRef.current?.click()}
                className="px-4 py-2 bg-purple-500 text-white rounded-lg font-medium flex items-center gap-2 hover:bg-purple-600"
              >
                <Icons.Image />
                Photo
              </button>

              <button
                onClick={saveLayout}
                className="px-4 py-2 bg-blue-500 text-white rounded-lg font-medium flex items-center gap-2 hover:bg-blue-600"
              >
                <Icons.Save />
                Save
              </button>

              <button
                onClick={exportLayout}
                className="px-4 py-2 bg-green-500 text-white rounded-lg font-medium flex items-center gap-2 hover:bg-green-600"
              >
                <Icons.Download />
                Export
              </button>

              <input
                ref={importInputRef}
                type="file"
                accept=".json"
                onChange={importLayout}
                className="hidden"
              />
              <button
                onClick={() => importInputRef.current?.click()}
                className="px-4 py-2 bg-indigo-500 text-white rounded-lg font-medium flex items-center gap-2 hover:bg-indigo-600"
              >
                <Icons.Upload />
                Import
              </button>

              <button
                onClick={() => setShowSettings(true)}
                className="px-4 py-2 bg-purple-600 text-white rounded-lg font-medium hover:bg-purple-700"
              >
                Shopify
              </button>

              {shopifyConfig.connected && (
                <div className="flex items-center gap-2 bg-green-100 px-3 py-2 rounded-lg">
                  <div className="w-2 h-2 bg-green-500 rounded-full"></div>
                  <span className="text-sm font-medium text-green-700">Connected</span>
                </div>
              )}
            </div>
          </div>

          <div className="flex-1 flex overflow-hidden">
            {/* Left Sidebar - Fixture Library */}
            <div className="w-64 bg-white border-r border-gray-200 p-4 overflow-y-auto">
              <h2 className="text-lg font-bold mb-4 text-gray-800">Fixture Library</h2>
              
              <div className="space-y-3">
                {fixtureTypes.map(type => (
                  <button
                    key={type.id}
                    onClick={() => addFixture(type.id)}
                    className="w-full p-4 border-2 border-gray-200 rounded-lg hover:border-blue-400 hover:bg-blue-50 transition-all group"
                  >
                    <div className="flex flex-col items-center gap-2">
                      <div className="text-gray-600 group-hover:text-blue-600 transition-colors" style={{ color: type.color }}>
                        <type.icon />
                      </div>
                      <span className="text-sm font-medium text-gray-700 group-hover:text-blue-600">
                        {type.name}
                      </span>
                    </div>
                  </button>
                ))}
              </div>

              {/* Zoom Controls */}
              <div className="mt-6 pt-6 border-t border-gray-200">
                <h3 className="text-sm font-bold mb-3 text-gray-700">View Controls</h3>
                <div className="flex gap-2">
                  <button
                    onClick={handleZoomIn}
                    className="flex-1 px-3 py-2 bg-gray-200 rounded hover:bg-gray-300 flex items-center justify-center gap-1"
                  >
                    <Icons.ZoomIn />
                  </button>
                  <button
                    onClick={handleZoomOut}
                    className="flex-1 px-3 py-2 bg-gray-200 rounded hover:bg-gray-300 flex items-center justify-center gap-1"
                  >
                    <Icons.ZoomOut />
                  </button>
                </div>
                <div className="mt-2 text-center text-sm text-gray-600">
                  Zoom: {Math.round(zoom * 100)}%
                </div>
              </div>

              {/* Selected Fixture Info */}
              {selectedFixture && (
                <div className="mt-6 pt-6 border-t border-gray-200">
                  <h3 className="text-sm font-bold mb-3 text-gray-700">Selected Fixture</h3>
                  <div className="space-y-2">
                    <div className="text-sm text-gray-600">
                      {fixtures.find(f => f.id === selectedFixture)?.name}
                    </div>
                    <button
                      onClick={() => {
                        const rows = prompt('How many rows to add?', '1');
                        if (rows) addRowsToFixture(selectedFixture, parseInt(rows));
                      }}
                      className="w-full px-3 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 text-sm flex items-center justify-center gap-2"
                    >
                      <Icons.Plus />
                      Add Rows
                    </button>
                    <button
                      onClick={() => deleteFixture(selectedFixture)}
                      className="w-full px-3 py-2 bg-red-500 text-white rounded hover:bg-red-600 text-sm flex items-center justify-center gap-2"
                    >
                      <Icons.Trash />
                      Delete
                    </button>
                  </div>
                </div>
              )}
            </div>

            {/* Canvas Area */}
            <div className="flex-1 relative bg-gray-100">
              <canvas
                ref={canvasRef}
                width={1200}
                height={800}
                onMouseDown={handleMouseDown}
                onMouseMove={handleMouseMove}
                onMouseUp={handleMouseUp}
                onContextMenu={(e) => e.preventDefault()}
                className="cursor-move"
              />
            </div>

            {/* Right Sidebar - Section Details */}
            <div className="w-80 bg-white border-l border-gray-200 p-4 overflow-y-auto">
              {selectedSection && sections[selectedSection] ? (
                <div>
                  <div className="flex items-center justify-between mb-4">
                    {editingSection === selectedSection ? (
                      <input
                        type="text"
                        value={sections[selectedSection].name}
                        onChange={(e) => renameSection(selectedSection, e.target.value)}
                        onBlur={() => setEditingSection(null)}
                        onKeyDown={(e) => {
                          if (e.key === 'Enter') setEditingSection(null);
                        }}
                        className="text-lg font-bold flex-1 border-b-2 border-blue-500 focus:outline-none"
                        autoFocus
                      />
                    ) : (
                      <h2
                        onClick={() => setEditingSection(selectedSection)}
                        className="text-lg font-bold cursor-pointer hover:text-blue-600"
                      >
                        {sections[selectedSection].name}
                      </h2>
                    )}
                    <button
                      onClick={() => setEditingSection(selectedSection)}
                      className="p-1 hover:bg-gray-100 rounded"
                    >
                      <Icons.Edit />
                    </button>
                  </div>

                  {/* Metrics */}
                  <div className="bg-gradient-to-br from-blue-50 to-purple-50 rounded-lg p-4 mb-4">
                    <div className="space-y-3">
                      <div>
                        <div className="text-xs text-gray-600 mb-1">Total Profit ({timePeriod})</div>
                        <div className="text-2xl font-bold text-green-600">
                          ${calculateSectionProfit(sections[selectedSection]).toFixed(2)}
                        </div>
                      </div>
                      <div>
                        <div className="text-xs text-gray-600 mb-1">Profit per sq ft</div>
                        <div className="text-xl font-bold text-blue-600">
                          ${calculateProfitPerSqFt(sections[selectedSection]).toFixed(2)}
                        </div>
                      </div>
                      <div>
                        <div className="text-xs text-gray-600 mb-1">Products</div>
                        <div className="text-lg font-semibold text-gray-700">
                          {sections[selectedSection].products.length}
                        </div>
                      </div>
                    </div>
                  </div>

                  {/* Product Search */}
                  <div className="mb-4">
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      Search Products
                    </label>
                    <div className="flex gap-2">
                      <input
                        type="text"
                        value={upcInput}
                        onChange={(e) => setUpcInput(e.target.value)}
                        onKeyDown={(e) => {
                          if (e.key === 'Enter') searchShopifyProducts(upcInput);
                        }}
                        placeholder="Search by name or SKU..."
                        className="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                      />
                      <button
                        onClick={() => searchShopifyProducts(upcInput)}
                        className="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 flex items-center gap-2"
                      >
                        <Icons.Search />
                      </button>
                    </div>
                  </div>

                  {/* Search Results */}
                  {productSearchResults.length > 0 && (
                    <div className="mb-4 max-h-64 overflow-y-auto border border-gray-200 rounded-lg">
                      {productSearchResults.map((product, idx) => (
                        <div
                          key={idx}
                          onClick={() => addProductToSection(product)}
                          className="p-3 hover:bg-blue-50 cursor-pointer border-b border-gray-100 last:border-b-0"
                        >
                          <div className="font-medium text-sm">{product.title}</div>
                          <div className="text-xs text-gray-600">
                            ${product.variants?.[0]?.price || 'N/A'}
                          </div>
                        </div>
                      ))}
                    </div>
                  )}

                  {/* Products List */}
                  <div>
                    <h3 className="text-sm font-bold mb-2 text-gray-700">Products in Section</h3>
                    <div className="space-y-2">
                      {sections[selectedSection].products.map((product) => (
                        <div
                          key={product.id}
                          className="p-3 bg-gray-50 rounded-lg border border-gray-200"
                        >
                          <div className="font-medium text-sm mb-1">{product.title}</div>
                          <div className="text-xs text-gray-600 space-y-1">
                            <div>Price: ${product.price.toFixed(2)}</div>
                            <div>Cost: ${product.cost.toFixed(2)}</div>
                            <div>Qty: {product.quantity}</div>
                            <div className="font-semibold text-green-600">
                              Profit: ${((product.price - product.cost) * product.quantity).toFixed(2)}
                            </div>
                          </div>
                          <button
                            onClick={() => {
                              setSections({
                                ...sections,
                                [selectedSection]: {
                                  ...sections[selectedSection],
                                  products: sections[selectedSection].products.filter(p => p.id !== product.id)
                                }
                              });
                            }}
                            className="mt-2 w-full px-2 py-1 bg-red-500 text-white rounded text-xs hover:bg-red-600"
                          >
                            Remove
                          </button>
                        </div>
                      ))}
                    </div>
                  </div>
                </div>
              ) : (
                <div className="text-center text-gray-500 mt-8">
                  <Icons.Package />
                  <p className="mt-2">Select a section to view details</p>
                </div>
              )}
            </div>
          </div>

          {/* Shopify Settings Modal */}
          {showSettings && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
              <div className="bg-white rounded-lg p-6 w-96">
                <h2 className="text-xl font-bold mb-4">Shopify Settings</h2>
                <div className="space-y-4">
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      Store Name
                    </label>
                    <input
                      type="text"
                      value={shopifyConfig.storeName}
                      onChange={(e) => setShopifyConfig({...shopifyConfig, storeName: e.target.value})}
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg"
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      Access Token
                    </label>
                    <input
                      type="password"
                      value={shopifyConfig.accessToken}
                      onChange={(e) => setShopifyConfig({...shopifyConfig, accessToken: e.target.value})}
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg"
                    />
                  </div>
                  <div className="flex gap-2">
                    <button
                      onClick={() => {
                        setShopifyConfig({...shopifyConfig, connected: true});
                        localStorage.setItem('shopifyConfig', JSON.stringify({...shopifyConfig, connected: true}));
                        setShowSettings(false);
                      }}
                      className="flex-1 px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600"
                    >
                      Connect
                    </button>
                    <button
                      onClick={() => setShowSettings(false)}
                      className="flex-1 px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400"
                    >
                      Cancel
                    </button>
                  </div>
                </div>
              </div>
            </div>
          )}
        </div>
      );
    };

    ReactDOM.render(<StorePlannerPro />, document.getElementById('root'));
  </script>
</body>
</html>
